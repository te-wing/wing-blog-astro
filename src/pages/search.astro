---
const url = new URL(Astro.request.url);
const token = url.searchParams.get('token');
const query = url.searchParams.get('q');

const VERIFY_URL = 'https://challenges.cloudflare.com/turnstile/v0/siteverify';

const res = await fetch(VERIFY_URL, {
  method: 'POST',
  headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
  body: new URLSearchParams({
    secret: import.meta.env.TURNSTILE_SECRET_KEY,
    response: token,
    remoteip: Astro.request.headers.get('x-forwarded-for') ?? ''
  })
});

const result = await res.json();

if (!result.success) {
  throw new Error('無効なTurnstileトークンです');
}
---
<h1>検索結果: {query}</h1>
<!-- 検索ロジックをここに追加 -->